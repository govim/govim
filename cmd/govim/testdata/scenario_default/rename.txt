# Test that renaming of identifiers works

vim ex 'e main.go'
vim ex 'call cursor(8,7)'
vim ex 'call execute(\"GOVIMRename banana\")'
vim ex 'silent noautocmd wall'
vim -indent call execute '["ls"]'
#stdout '"\n  1 %a   \\"main.go\\"                      line 7\n  2 #a   \"'$WORK/other.go'\" line 0"'
#! stderr .+
cmp main.go main.go.banana
cmp other.go other.go.banana

# Disabled pending resolution to https://github.com/golang/go/issues/34103
# errlogmatch -count=0 'LogMessage callback: &protocol\.LogMessageParams\{Type:(1|2), Message:".*'

-- go.mod --
module mod.com

go 1.12
-- main.go --
package main

import "fmt"

var i int

func main() {
	i += i + 5
	fmt.Printf("i: %v\n", i)
}
-- main.go.banana --
package main

import "fmt"

var banana int

func main() {
	banana += banana + 5
	fmt.Printf("i: %v\n", banana)
}
-- other.go --
package main

func DoIt() {
	i = 6 + i
}
-- other.go.banana --
package main

func DoIt() {
	banana = 6 + banana
}

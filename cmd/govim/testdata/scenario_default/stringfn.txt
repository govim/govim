# Test that GOVIMStringFn works

# No range in .go file
vim ex 'e main.go'
vim ex 'call cursor(7,1) | GOVIMStringFn crypto/sha256.Sum256 encoding/hex.EncodeToString'

# Multi-line selection
vim ex 'call cursor(11,1)'
vim ex 'normal Vjj:'
vim ex '''<,''>GOVIMStringFn encoding/hex.EncodeToString'

vim ex 'call cursor(15,1) | GOVIMStringFn regexp.QuoteMeta'
vim ex 'w'
cmp main.go main.go.golden

# Entire file w/o visual mode
vim ex '%GOVIMStringFn encoding/hex.EncodeToString'
vim ex 'w'
cmp main.go main.go.golden.hex

skip 'Pending work to fix up Vim commands in test'

# Assert that we have received no error (Type: 1) or warning (Type: 2) log messages
# Disabled pending resolution to https://github.com/golang/go/issues/34103
# errlogmatch -start -count=0 'LogMessage callback: &protocol\.LogMessageParams\{Type:(1|2), Message:".*'

-- go.mod --
module mod

go 1.12
-- main.go --
package main

import "fmt"

func main() {
	fmt.Println(`
test
`)
	fmt.Println("test")
	multiline := `
Lorem ipsum dolor sit amet,
    consectetur adipiscing elit, sed
         do eiusmod tempor incididunt ut labore et dolore magna aliqua.
`
}

// Here is an (end-of-file) line
-- main.go.golden --
package main

import "fmt"

func main() {
	fmt.Println(`
9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08
`)
	fmt.Println("test")
	multiline := `
4c6f72656d20697073756d20646f6c6f722073697420616d65742c0a20202020636f6e73656374657475722061646970697363696e6720656c69742c207365640a202020202020202020646f20656975736d6f642074656d706f7220696e6369646964756e74207574206c61626f726520657420646f6c6f7265206d61676e6120616c697175612e
`
}

// Here is an \(end-of-file\) line
-- main.go.golden.hex --
7061636b616765206d61696e0a0a696d706f72742022666d74220a0a66756e63206d61696e2829207b0a09666d742e5072696e746c6e28600a396638366430383138383463376436353961326665616130633535616430313561336266346631623262306238323263643135643663313562306630306130380a60290a09666d742e5072696e746c6e28227465737422290a096d756c74696c696e65203a3d20600a34633666373236353664323036393730373337353664323036343666366336663732323037333639373432303631366436353734326330613230323032303230363336663665373336353633373436353734373537323230363136343639373036393733363336393665363732303635366336393734326332303733363536343061323032303230323032303230323032303230363436663230363536393735373336643666363432303734363536643730366637323230363936653633363936343639363437353665373432303735373432303663363136323666373236353230363537343230363436663663366637323635323036643631363736653631323036313663363937313735363132650a600a7d0a0a2f2f204865726520697320616e205c28656e642d6f662d66696c655c29206c696e65

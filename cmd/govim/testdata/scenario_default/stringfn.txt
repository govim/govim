# Test that GOVIMStringFn works

# No range in .go file
vim ex 'e main.go'
vim ex 'call cursor(7,1) | GOVIMStringFn crypto/sha256.Sum256 encoding/hex.EncodeToString'

# Multi-line selection
vim ex 'call cursor(11,1)'
vim ex 'normal Vjj:'
vim ex '''<,''>GOVIMStringFn encoding/hex.EncodeToString'

vim ex 'call cursor(15,1) | GOVIMStringFn regexp.QuoteMeta'
vim ex 'w'
cmp main.go main.go.golden

skip 'Pending work to fix up Vim commands in test'

# Assert that we have received no error (Type: 1) or warning (Type: 2) log messages
# Disabled pending resolution to https://github.com/golang/go/issues/34103
# errlogmatch -start -count=0 'LogMessage callback: &protocol\.LogMessageParams\{Type:(1|2), Message:".*'

-- go.mod --
module mod

go 1.12
-- main.go --
package main

import "fmt"

func main() {
	fmt.Println(`
test
`)
	fmt.Println("test")
	multiline := `
Lorem ipsum dolor sit amet,
    consectetur adipiscing elit, sed
         do eiusmod tempor incididunt ut labore et dolore magna aliqua.
`
}

// Here is an (end-of-file) line
-- main.go.golden --
package main

import "fmt"

func main() {
	fmt.Println(`
9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08
`)
	fmt.Println("test")
	multiline := `
4c6f72656d20697073756d20646f6c6f722073697420616d65742c0a20202020636f6e73656374657475722061646970697363696e6720656c69742c207365640a202020202020202020646f20656975736d6f642074656d706f7220696e6369646964756e74207574206c61626f726520657420646f6c6f7265206d61676e6120616c697175612e
`
}

// Here is an \(end-of-file\) line
